{% extends "core/core_base.html" %}
{% block head %}
    <script src="{{ MEDIA_URL }}javascripts/jquery.tablesorter/jquery.tablesorter.js" type="text/javascript"></script>
{% endblock %}
{% block core_content %}

<style type="text/css">
.center{
    text-align: center;
}
</style>
<script type="text/javascript">
    $(document).ready(function() {
        function get_and_display_search(){
            search = document.getElementById('id_search').value;
            window.location.hash = '#q='+search;
            $('#results').html('<p>Please wait while we retrieve your results...<p>');
            var start = new Date().getTime();

            $.get('/core/search/search_ajax?search='+escape(search),
            function update_results(data){
                // First make the banner go away. Then push everthing to the left... just like google.
                $('#banner_text').empty();
                $('#results').html('');
                $('#banner_area').css('text-align', 'left');
                $('.banner').css('margin-bottom', '10px');
                $('#btn_i').remove();
                results = document.getElementById('results');
                results.innerHTML = data;
                // Every table needs to have it's feilds configured.
                $(".system-table").tablesorter({
                    headers: {
                        0: { sorter:'hostname' },
                        1: { sorter:'ipAddress' },
                    }
                });
                $(".record-table").tablesorter({
                    headers: {
                        0: { sorter:'hostname' },
                        1: { sorter:false },
                        2: { sorter:'hostname' },
                    }
                });
                $(".intr-table").tablesorter({
                    headers: {
                        0: { sorter:'hostname' },
                        1: { sorter:false },
                        2: { sorter:'ipAddress' },
                    }
                });
                $(".ptr-table").tablesorter({
                    headers: {
                        0: { sorter:'ipAddress' },
                        1: { sorter:false },
                        2: { sorter:'hostname' },
                    }
                });
                $(".addr-table").tablesorter({
                    headers: {
                        1: { sorter:false },
                        2: { sorter:'ipAddress' },
                    }
                });

                var end = new Date().getTime();
                var time = end - start;
                $('#search-time').html('In ('+time/1000+' seconds)');
            });
        }

        $('#btn_s').click(function (){
                get_and_display_search();
        });
        $('#btn_i').click(function (){
                get_and_display_search();
        });
        // hash, we use that data as the initial data.
        var prmarr = window.location.hash.split('&');
        console.log(window.location.hash);
        var params = window.location.hash.substr(3)
        if ( params != ""){
            $('#id_search').attr('value', params);
            get_and_display_search();
        }
    });
</script>
<div id="banner_area" class="banner center">
    <div id='banner_text'><h1>Inventory</h1></div>
    <input class='search_tools' id="id_search" type="text" size="50" name="search" value="{{ search }}" autofocus="autofocus" style='margin-bottom; 20px'>
    <div style='display:block;'></div>
    <input class='search_tools' value="Search" title="Search" type="button" id="btn_s">
    <input value="I'm Feeling Lucky" title="I'm Feeling Lucky" name="lucky" type="submit" id="btn_i">
    <input class='search_tools' value="Help" title="Help" type="button" id="help_button">
</div>
<div id="results" width="100%">
</div>
{% include 'search/core_search_help.html' %}
{% endblock %}
